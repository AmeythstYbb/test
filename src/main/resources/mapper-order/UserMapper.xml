<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 不使用namespace的话sql搜索定位会比较方便 -->
<mapper namespace="com.zlycare.web.boss_24.core.dao.mapper.UserMapper">
    <resultMap id="userMapper" type="com.zlycare.web.boss_24.core.dao.po.UserPo">
        <id property="id" column="id"/>
        <result property="jobNumber" column="job_number"/>
        <result property="password" column="password"/>
        <result property="userName" column="user_name"/>
        <result property="status" column="status"/>
        <result column="dept_id" property="deptId"/>
        <result column="mobile" property="mobile"/>
        <result column="dept_children_id" property="deptChildrenId"/>
        <result property="createDate" column="create_date"/>
        <result property="deleteFlag" column="delete_flag"/>
        <result property="loginIp" column="login_ip"/>
        <result property="loginDate" column="login_date"/>
        <result property="area" column="area"/>
    </resultMap>

    <!-- 用于select查询公用抽取的列 -->
    <sql id="columns">
        id,job_number,password,user_name,status,dept_id,dept_children_id,create_date,delete_flag,login_ip,login_date,area,mobile
    </sql>

    <!-- 通过id查询 -->
    <select id="findOne" resultMap="userMapper">
        SELECT
        <include refid="columns"/>
        FROM user
        WHERE id = #{id}
    </select>
    <!-- 通过登录名查询 -->
    <select id="findByJobNumber" resultMap="userMapper">
        SELECT
        <include refid="columns"/>
        FROM user
        WHERE job_number = #{jobNumber}
        AND delete_flag = #{deleteFlag}
    </select>
    <!-- 通过登录名查询，包含已经删除 -->
    <select id="getAllUserByJobNumber" resultMap="userMapper">
        SELECT
        <include refid="columns"/>
        FROM user
        WHERE job_number = #{jobNumber}
    </select>
    <!-- 查询所有可删除用户 -->
    <select id="findUserName" resultMap="userMapper">
        SELECT
        <include refid="columns"/>
        FROM user
        WHERE delete_flag = #{deleteFlag}
    </select>
    <!--根据id删除用户,实则修改删除状态-->
    <update id="deleteById">
        UPDATE user
        <set>
            <if test="deleteFlag != null and deleteFlag != ''">
                delete_flag = #{deleteFlag} ,
            </if>
        </set>
        WHERE
        id = #{id}
    </update>
    <!--根据id修改密码-->
    <update id="updatePasswordById">
        UPDATE user
        <set>
            <if test="password != null and password != ''">
                password = #{password} ,
            </if>
        </set>
        WHERE
        id = #{id}
    </update>

    <!--根据id修改用户业务区域-->
    <update id="updateArea">
        UPDATE user
        <set>
            <if test="area != null and area != ''">
                area = #{area} ,
            </if>
        </set>
        WHERE
        id = #{id}
    </update>

    <!--根据id修改登录信息-->
    <update id="updateLoginInfo">
        UPDATE user
        <set>
            <if test="loginIp != null and loginIp != ''">
                login_ip = #{loginIp} ,
            </if>
            <if test="loginDate != null ">
                login_date = #{loginDate} ,
            </if>
        </set>
        WHERE
        id = #{id}
    </update>

    <!-- 查询所有用户 -->
    <select id="findAllList" resultMap="userMapper">
        SELECT
        <include refid="columns"/>
        FROM user
        WHERE delete_flag = #{deleteFlag}
    </select>

    <!-- 查询所有用户 -->
    <select id="findAllListPage" resultMap="userMapper">
        SELECT
        <include refid="columns"/>
        FROM user
        WHERE delete_flag = #{deleteFlag}
        <if test="start!=null and pageSize != null ">
            LIMIT #{start},#{pageSize}
        </if>
    </select>


    <!-- 查询所有用户 -->
    <select id="findUserBySearch" resultMap="userMapper">
        SELECT
        <include refid="columns"/>
        FROM user
        WHERE delete_flag = #{deleteFlag}
        <if test="jobNumber!=null and jobNumber != '' ">
            and job_number LIKE CONCAT('%',#{jobNumber},'%')
        </if>
        <if test="start!=null and pageSize != null ">
            LIMIT #{start},#{pageSize}
        </if>
    </select>

    <!-- 查询所有用户 -->
    <select id="countBySearch" resultType="java.lang.Integer" parameterType="java.util.Map">
        SELECT
        count(*)
        FROM user
        WHERE delete_flag = #{deleteFlag}
        <if test="jobNumber!=null and jobNumber != '' ">
            and job_number LIKE CONCAT('%',#{jobNumber},'%')
        </if>
    </select>
</mapper>